---
title: FIFO складской учёт по партиям
description: Как работает FIFO учёт в OpenMPFlow — партии закупок, расчёт себестоимости, распределение затрат, COGS
---

## Что такое FIFO учёт

FIFO (First In, First Out) — метод учёта, при котором при продаже списывается себестоимость самой старой партии товара. Это даёт точный расчёт прибыли по каждой продаже.

## Как это работает в OpenMPFlow

### Партии (FIFO Lots)

Каждая закупка создаёт **партию** (lot) — запись с количеством, себестоимостью единицы и оставшимся количеством.

```
Партия 1 (январь)  — 100 шт × 450 ₽ → осталось 0 шт   ✓ продано
Партия 2 (февраль) — 200 шт × 520 ₽ → осталось 80 шт   частично
Партия 3 (март)    — 150 шт × 480 ₽ → осталось 150 шт   на складе
```

### Автоматический FIFO при продаже

При синхронизации продаж с Ozon система автоматически:

1. Берёт самую старую партию с остатком
2. Списывает нужное количество
3. Если в партии не хватает — переходит к следующей
4. Записывает точную себестоимость (COGS) для каждой продажи

### Распределение затрат

Себестоимость партии складывается из нескольких компонентов:

| Компонент | Описание |
|-----------|----------|
| Закупочная цена | Цена товара у поставщика (CNY или RUB) |
| Логистика | Доставка от поставщика до склада Ozon |
| Таможня | Таможенные пошлины и сборы |
| Упаковка | Маркировка, упаковка, подготовка |

Все затраты вводятся при создании заказа поставщику и автоматически распределяются на единицу товара.

## Заказы поставщикам

### Создание заказа

Заказ содержит:
- Список товаров с количеством и ценой
- Общие затраты (shared costs): логистика, таможня, упаковка
- Валюта закупки (поддерживается CNY с автоматическим пересчётом)

### Приёмка заказа

При приёмке заказа:
1. Общие затраты распределяются пропорционально стоимости товаров
2. Создаются FIFO-партии для каждого SKU
3. Себестоимость единицы = (закупка + доля общих затрат) / количество

## Пример расчёта

Заказ на 2 товара:
- Товар A: 100 шт × 200 CNY
- Товар B: 50 шт × 400 CNY

Общие затраты: логистика 50,000 ₽

Доля товара A: (100 × 200) / (100 × 200 + 50 × 400) = 50%
Доля товара B: 50%

Себестоимость единицы A = 200 CNY × курс + 25,000 ₽ / 100
Себестоимость единицы B = 400 CNY × курс + 25,000 ₽ / 50

## MCP инструменты

| Инструмент | Описание |
|------------|----------|
| `inventory_overview` | Текущие остатки с разбивкой по партиям |
| `inventory_initial_balance` | Ввод начальных остатков |
| `inventory_adjust` | Корректировка остатков |
| `orders_create` | Создание заказа поставщику |
| `orders_receive` | Приёмка заказа (создание FIFO-партий) |
